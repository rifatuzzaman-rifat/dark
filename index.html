<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secure Access</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f0f1a, #2a2a4a);
      color: #fff;
      overflow: auto;
    }
    .container {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 30px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      text-align: center;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h2 {
      font-size: 26px;
      margin-bottom: 20px;
      color: #00f7ff;
      text-shadow: 0 0 10px #00f7ff, 0 0 20px #00f7ff;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      color: #fff;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    input:focus {
      outline: none;
      border-color: #ff00cc;
      box-shadow: 0 0 12px #ff00cc;
    }
    button {
      background: linear-gradient(135deg, #00f7ff, #ff00cc);
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 5px;
      transition: all 0.3s ease;
      animation: pulse 2s infinite;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 247, 255, 0.6);
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(0, 247, 255, 0.4); }
      50% { box-shadow: 0 0 20px 10px rgba(0, 247, 255, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0, 247, 255, 0); }
    }
    .error {
      color: #ff4d4d;
      font-size: 14px;
      margin-top: 10px;
      animation: shake 0.3s ease;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    .hidden {
      display: none;
    }
    #patternCanvas {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 10px;
      margin: 20px auto;
      display: block;
    }
    @media (max-width: 480px) {
      .container {
        padding: 20px;
        margin: 10px;
      }
      #patternCanvas {
        width: 250px;
        height: 250px;
      }
      h2 {
        font-size: 22px;
      }
      button {
        padding: 10px 15px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="login">
    <h2>Layer 1: Login</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="verifyLogin()">Login</button>
    <p id="login-error" class="error"></p>
  </div>
  <div class="container hidden" id="pattern-lock">
    <h2>Layer 2: Pattern Lock</h2>
    <canvas id="patternCanvas" width="300" height="300"></canvas>
    <button onclick="resetPattern()">Reset</button>
    <button onclick="verifyPattern()">Submit</button>
    <p id="pattern-error" class="error"></p>
  </div>
  <div class="container hidden" id="security-question">
    <h2>Layer 3: Security Question</h2>
    <p id="question"></p>
    <input type="text" id="answer" placeholder="Your answer">
    <button onclick="verifyAnswer()">Submit</button>
    <p id="question-error" class="error"></p>
  </div>
  <div class="container hidden" id="content">
    <h2>Confidential Content</h2>
    <p>Welcome, authorized user! This is your secret data.</p>
  </div>

  <script>
    // User data (plain text passwords, patterns, and answers)
    const users = {
      'rifat': {
        password: '312205',
        pattern: [5,2,8,4,3,7,6,1,9],
        questions: [
          { q: 'What is your favorite book?', answer: 'ebook' },
          { q: 'What was your first pet’s name?', answer: 'donno' },
          { q: 'What city were you born in?', answer: 'unborn' }
        ]
      },
      'apurbo': {
        password: 'acs@uhf',
        pattern: [7,4,1,5,3,6,9],
        questions: [
          { q: 'Who is your crush?', answer: 'maria' },
          { q: 'What was your dream with her?', answer: 'marry' },
          { q: 'What city were you born in?', answer: 'mohanganj' }
        ]
      },
      'shofiur': {
        password: 'password3',
        pattern: [1,2,3,6,5,4,7,8,9],
        questions: [
          { q: 'What is your favorite book?', answer: 'book1' },
          { q: 'What was your first pet’s name?', answer: 'pet1' },
          { q: 'What city were you born in?', answer: 'city1' }
        ]
      }
    };

    let currentUser = null;
    let totalAttempts = 0;
    const maxAttempts = 3;

    // Layer 1: Username and Password
    function verifyLogin() {
      if (totalAttempts >= maxAttempts) {
        document.getElementById('login-error').textContent = 'Too many attempts. Access blocked.';
        disableInputs();
        return;
      }

      const username = document.getElementById('username').value.toLowerCase();
      const password = document.getElementById('password').value;
      const error = document.getElementById('login-error');

      if (users[username]) {
        if (password === users[username].password) {
          currentUser = username;
          document.getElementById('login').classList.add('hidden');
          document.getElementById('pattern-lock').classList.remove('hidden');
        } else {
          totalAttempts++;
          error.textContent = `Invalid password. ${maxAttempts - totalAttempts} attempts left.`;
        }
      } else {
        totalAttempts++;
        error.textContent = `Invalid username. ${maxAttempts - totalAttempts} attempts left.`;
      }
    }

    // Layer 2: Pattern Lock
    const canvas = document.getElementById('patternCanvas');
    const ctx = canvas.getContext('2d');
    let currentPattern = [];
    let isDrawing = false;

    const dots = [
      { x: 50, y: 50, id: 1 }, { x: 150, y: 50, id: 2 }, { x: 250, y: 50, id: 3 },
      { x: 50, y: 150, id: 4 }, { x: 150, y: 150, id: 5 }, { x: 250, y: 150, id: 6 },
      { x: 50, y: 250, id: 7 }, { x: 150, y: 250, id: 8 }, { x: 250, y: 250, id: 9 }
    ];

    function drawDots() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      dots.forEach(dot => {
        ctx.beginPath();
        ctx.arc(dot.x, dot.y, 20, 0, 2 * Math.PI);
        ctx.fillStyle = currentPattern.includes(dot.id) ? '#00f7ff' : 'rgba(255, 255, 255, 0.3)';
        ctx.fill();
        ctx.strokeStyle = currentPattern.includes(dot.id) ? '#ff00cc' : 'rgba(255, 255, 255, 0.2)';
        ctx.lineWidth = 2;
        ctx.stroke();
      });

      if (currentPattern.length >= 2) {
        const startIndex = currentPattern[0] - 1;
        const endIndex = currentPattern[currentPattern.length - 1] - 1;

        if (startIndex >= 0 && endIndex >= 0 && startIndex < dots.length && endIndex < dots.length) {
          const startDot = dots[startIndex];
          const endDot = dots[endIndex];

          if (startDot && endDot && !isNaN(startDot.x) && !isNaN(startDot.y) && !isNaN(endDot.x) && !isNaN(endDot.y)) {
            ctx.beginPath();
            ctx.moveTo(startDot.x, startDot.y);
            for (let i = 1; i < currentPattern.length; i++) {
              const dotIndex = currentPattern[i] - 1;
              if (dotIndex >= 0 && dotIndex < dots.length) {
                const dot = dots[dotIndex];
                if (dot && !isNaN(dot.x) && !isNaN(dot.y)) {
                  ctx.lineTo(dot.x, dot.y);
                }
              }
            }

            const gradient = ctx.createLinearGradient(startDot.x, startDot.y, endDot.x, endDot.y);
            gradient.addColorStop(0, '#00f7ff');
            gradient.addColorStop(1, '#ff00cc');
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 5;
            ctx.stroke();
          }
        }
      }
    }

    canvas.addEventListener('mousedown', (e) => {
      isDrawing = true;
      checkDot(e);
    });

    canvas.addEventListener('mousemove', (e) => {
      if (isDrawing) checkDot(e);
    });

    canvas.addEventListener('mouseup', () => {
      isDrawing = false;
    });

    canvas.addEventListener('touchstart', (e) => {
      isDrawing = true;
      checkDot(e.touches[0]);
    });

    canvas.addEventListener('touchmove', (e) => {
      if (isDrawing) {
        e.preventDefault();
        checkDot(e.touches[0]);
      }
    });

    canvas.addEventListener('touchend', () => {
      isDrawing = false;
    });

    function checkDot(e) {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      dots.forEach(dot => {
        if (Math.sqrt((x - dot.x) ** 2 + (y - dot.y) ** 2) < 20 && !currentPattern.includes(dot.id)) {
          currentPattern.push(dot.id);
          drawDots();
        }
      });
    }

    function resetPattern() {
      currentPattern = [];
      drawDots();
    }

    function verifyPattern() {
      if (totalAttempts >= maxAttempts) {
        document.getElementById('pattern-error').textContent = 'Too many attempts. Access blocked.';
        disableInputs();
        return;
      }
      if (currentPattern.join() === users[currentUser].pattern.join()) {
        document.getElementById('pattern-lock').classList.add('hidden');
        document.getElementById('security-question').classList.remove('hidden');
        const questions = users[currentUser].questions;
        const selectedQuestion = questions[Math.floor(Math.random() * questions.length)];
        document.getElementById('question').textContent = selectedQuestion.q;
        window.selectedQuestion = selectedQuestion;
      } else {
        totalAttempts++;
        document.getElementById('pattern-error').textContent = `Invalid pattern. ${maxAttempts - totalAttempts} attempts left.`;
        resetPattern();
      }
    }

    drawDots();

    // Layer 3: Security Question
    function verifyAnswer() {
      if (totalAttempts >= maxAttempts) {
        document.getElementById('question-error').textContent = 'Too many attempts. Access blocked.';
        disableInputs();
        return;
      }
      const answer = document.getElementById('answer').value;
      if (answer === window.selectedQuestion.answer) {
        document.getElementById('security-question').classList.add('hidden');
        document.getElementById('content').classList.remove('hidden');
        // Redirect to index.html after showing welcome
        setTimeout(() => {
          window.location.href = 'stories.html';
        }, 800); // Redirect after 2 seconds to allow user to see the welcome message
      } else {
        totalAttempts++;
        document.getElementById('question-error').textContent = `Incorrect answer. ${maxAttempts - totalAttempts} attempts left.`;
      }
    }

    // Disable inputs on lockout
    function disableInputs() {
      document.querySelectorAll('input, button').forEach(el => el.disabled = true);
    }
  </script>
</body>
</html>